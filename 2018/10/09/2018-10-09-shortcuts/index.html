<!DOCTYPE html>
<html lang="">
  <head><meta name="generator" content="Hexo 3.9.0">
    
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">



  <meta name="description" content="Shortcuts App">




  <meta name="keywords" content="sirikit,shortcut,iOS12,">





  <link rel="alternate" href="/default" title="acumen1005">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=1.1">



<link rel="canonical" href="http://yoursite.com/2018/10/09/2018-10-09-shortcuts/">


<meta name="description" content="在 iOS12 系统推出，Apple 同时也发布了一个新的 App —— shortcuts。与以往不同的是该 App 不是直接集成在系统的中，而是在 App Store 中提供下载。shortcuts 翻译成 捷径。在 iOS9 就已经有 shortcut 的概念了，在 AppIcon 使用 3DTouch 就会出现一些 shortcutsItem 如果该 App 有集成的话（至少会有一个分享的">
<meta name="keywords" content="sirikit,shortcut,iOS12">
<meta property="og:type" content="article">
<meta property="og:title" content="Shortcuts App">
<meta property="og:url" content="http://yoursite.com/2018/10/09/2018-10-09-shortcuts/index.html">
<meta property="og:site_name" content="acumen1005">
<meta property="og:description" content="在 iOS12 系统推出，Apple 同时也发布了一个新的 App —— shortcuts。与以往不同的是该 App 不是直接集成在系统的中，而是在 App Store 中提供下载。shortcuts 翻译成 捷径。在 iOS9 就已经有 shortcut 的概念了，在 AppIcon 使用 3DTouch 就会出现一些 shortcutsItem 如果该 App 有集成的话（至少会有一个分享的">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://ww1.sinaimg.cn/mw690/0079laKdgy1fw1pxs4vunj30ka0emgm9.jpg">
<meta property="og:image" content="http://ww1.sinaimg.cn/mw690/0079laKdgy1fw1q6o16b1j30v60fpmyv.jpg">
<meta property="og:updated_time" content="2018-10-09T04:11:50.437Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Shortcuts App">
<meta name="twitter:description" content="在 iOS12 系统推出，Apple 同时也发布了一个新的 App —— shortcuts。与以往不同的是该 App 不是直接集成在系统的中，而是在 App Store 中提供下载。shortcuts 翻译成 捷径。在 iOS9 就已经有 shortcut 的概念了，在 AppIcon 使用 3DTouch 就会出现一些 shortcutsItem 如果该 App 有集成的话（至少会有一个分享的">
<meta name="twitter:image" content="http://ww1.sinaimg.cn/mw690/0079laKdgy1fw1pxs4vunj30ka0emgm9.jpg">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=1.1">
<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">





<script type="text/javascript">
  var themeConfig = {
    fancybox: {
      enable: false
    },
  };
</script>




  



    <title> Shortcuts App - acumen1005 </title>
  </head>

  <body>
    <div id="page">
      <header id="masthead"><div class="site-header-inner">
    <h1 class="site-title">
        <a href="/." class="logo">acumen1005</a>
    </h1>

    <nav id="nav-top">
        
            <ul id="menu-top" class="nav-top-items">
                
                    <li class="menu-item">
                        <a href="/archives">
                            
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/about">
                            
                            
                                About
                            
                        </a>
                    </li>
                
            </ul>
        
  </nav>
</div>

      </header>
      <div id="content">
        
    <div id="primary">
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          Shortcuts App
        
      </h1>
      <h1 class="post-preview">
      </h1>
      <time class="post-time">
          Oct 09 2018
      </time>
    </header>



    
            <div class="post-content">
            <p>在 iOS12 系统推出，Apple 同时也发布了一个新的 App —— shortcuts。与以往不同的是该 App 不是直接集成在系统的中，而是在 App Store 中提供下载。shortcuts 翻译成 捷径。在 iOS9 就已经有 shortcut 的概念了，在 AppIcon 使用 3DTouch 就会出现一些 shortcutsItem 如果该 App 有集成的话（至少会有一个分享的 item），所以 shortcuts 是为了让复杂的操作简单化的一个工具。那么我们如何在 App 中集成 shortcuts，或者说怎么在捷径 App 中使用我们的相关的功能呢？有两种方式能达到我们的目的： NSUserActivity  和 Intents</p>
<h1 id="NSUserActivity"><a href="#NSUserActivity" class="headerlink" title="NSUserActivity"></a>NSUserActivity</h1><ol>
<li><p>在 info.plist 中添加 NSUserActivityTypes 字段</p>
<p> 在 info.plist 中添加 <code>NSUserActivityTypes</code> 字段，并将设置唯一的 id 作为后面时候的 NSUserActivity 的 activityType。</p>
</li>
<li><p>在某一个 ViewController 中或者 UIResponse 子类中添加 userActivity</p>
<p> 创建一个 userActivity 对象，设置 title 和一些能否被 spotlight 搜索、是否支持 handoff 等等，然后通过 becomeCurrent  方法或者对 UIRepsonse 子类的中的 userActivity 赋值，将其注册到 shortcuts 中。</p>
</li>
</ol>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> userActivity = <span class="type">NSUserActivity</span>(activityType: <span class="string">"com.aaa.bbb.userActivity"</span>)</span><br><span class="line"><span class="keyword">if</span> #available(iOS <span class="number">9.0</span>, *) &#123;</span><br><span class="line">  userActivity.isEligibleForSearch = <span class="literal">true</span></span><br><span class="line">  userActivity.isEligibleForHandoff = <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> #available(iOS <span class="number">12</span>, *) &#123;</span><br><span class="line">  userActivity.isEligibleForPrediction = <span class="literal">true</span></span><br><span class="line">  userActivity.suggestedInvocationPhrase = <span class="string">"每日排行榜"</span></span><br><span class="line">&#125;</span><br><span class="line">userActivity.title = <span class="string">"xxx-每日排行榜"</span></span><br><span class="line"><span class="comment">//userActivity.becomeCurrent() 效果和 self.userActivity = userActivity 一样</span></span><br><span class="line"><span class="keyword">self</span>.userActivity = userActivity</span><br></pre></td></tr></table></figure>
<ol>
<li><p>在 AppDelegate 的回调方法内处理</p>
<p> 在该代理方法中对 userActivity 的 activityType 判断作出相应的处理</p>
</li>
</ol>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(<span class="number">_</span> application: UIApplication, <span class="keyword">continue</span> userActivity: NSUserActivity, restorationHandler: @escaping <span class="params">([Any]?)</span></span></span> -&gt; <span class="type">Void</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Intent"><a href="#Intent" class="headerlink" title="Intent"></a>Intent</h1><ol>
<li><p>新建 SiriKit intent</p>
<p> 新建一个 <code>SiriKit Intent Definition File</code> ，在 iOS12 中我们不能够自定义一个 Intent，而是这样的一个 Definition File，它类似一个模版。在编译阶段会生成对应的 Intent 类。</p>
</li>
</ol>
<p><img src="http://ww1.sinaimg.cn/mw690/0079laKdgy1fw1pxs4vunj30ka0emgm9.jpg" alt=""></p>
<p>以下是对应一个 <code>intentdefinition</code> 文件的内容，它可以包含多个 custom intent 和 system Intent。</p>
<p>我们可以看到一个 Intent 分为三个模块：Custom Intent、Parameters 和 Shortcut Types。</p>
<p><img src="http://ww1.sinaimg.cn/mw690/0079laKdgy1fw1q6o16b1j30v60fpmyv.jpg" alt=""></p>
<ol>
<li><p>Custom Intent </p>
<ul>
<li><p>Category 是 Intent 类别，它是系统为了提供了一些对 Intent 的分类。</p>
</li>
<li><p>Title 是标题，Intent 在 Shortcuts App 中显示的名称</p>
</li>
<li><p>Description 描述你的 Intent</p>
</li>
<li><p>Default Image 是一个 shortcuts 的 icon</p>
</li>
</ul>
</li>
<li><p>Parameters，在这个模块中定义参数，在生成的 xxxIntent 类中也会生成对应的属性。这些属性可以在下一个模块 Shortcut Types 中是使用，填充相应的 Title 和 subTitle</p>
</li>
<li><p>Shortcut Types 通过对参数的组合可以生成想要的模版</p>
</li>
</ol>
<p>Intent 还有 <code>response</code> 一项，也是和以上的类似，根据成功和失败给出相应的模版文案。</p>
<ol>
<li>添加到 shortcuts</li>
</ol>
<p>实例化一个自定义的 Intent，设置相关的属性。每一个 Intent 对应一个 INInteraction 然后调用 donate 方法，将这个 Intent “注册“ 到 Shortcuts。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> intent = <span class="type">PasteSearchIntent</span>()</span><br><span class="line">intent.hint = <span class="string">"输入你要搜索的词语（String）"</span></span><br><span class="line">intent.searchWord = <span class="string">"搜索词"</span></span><br><span class="line">registerIntent([intent, <span class="type">INSendMessageIntent</span>()])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">registerIntent</span><span class="params">(<span class="number">_</span> intents: [INIntent])</span></span> &#123;</span><br><span class="line">    intents.forEach &#123; intent <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">let</span> interaction = <span class="type">INInteraction</span>(intent: intent, response: <span class="literal">nil</span>)</span><br><span class="line">      interaction.donate &#123; error <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> error = error &#123;</span><br><span class="line">          <span class="built_in">print</span>(<span class="string">"error = \(error)"</span>)</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<pre><code>运行 App，在 Shortcut App 内就可以看到我们注册的 Intent。
</code></pre><ol>
<li><p>处理相应的 Intent</p>
<p> 用以下代理方法处理相应的 Intent 。</p>
</li>
</ol>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(<span class="number">_</span> application: UIApplication, <span class="keyword">continue</span> userActivity: NSUserActivity, restorationHandler: @escaping <span class="params">([Any]?)</span></span></span> -&gt; <span class="type">Void</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>Shortcuts App 是 Apple 对 workflow 的一个替代品，对用户更加友好。目前第三方 App 需要集成 shortcut，还不支持输入参数，我们看到有些 App 可以添加用户输入，像 <code>招商银行</code> 等，经过测试发现系统提供的部分 Intent 是支持用户输入的，可以在 Definition File 新建一个 System Intent。 不使用 System Intent ，还是有些办法可以达到这样的效果的，就是通过 URL Scheme 的方式传递参数。从产品的角度，App 中使用频繁、重复率高的功能可以作为集成 shortcut 的切入点，在用户第一次使用完这个功能之后，可以询问用户是否添加到 shortcut 以便之后高效使用。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://www.macstories.net/stories/shortcuts-a-new-vision-for-siri-and-ios-automation/#fn-54732-2" target="_blank" rel="noopener">Shortcuts: A New Vision for Siri and iOS Automation</a></p>
<p><a href="https://juejin.im/post/5b51b4335188251a9f24a214" target="_blank" rel="noopener">iOS12 Siri Shortcuts详解</a></p>
<p><a href="[https://developer.apple.com/documentation/sirikit#2979425](https://developer.apple.com/documentation/sirikit#2979425">SiriKit</a></p>

            </div>
          

    
      <footer class="post-footer">
		
		<div class="post-tags">
		  
			<a href="/tags/sirikit/">sirikit</a>
		  
			<a href="/tags/shortcut/">shortcut</a>
		  
			<a href="/tags/iOS12/">iOS12</a>
		  
		</div>
		

        
        
  <nav class="post-nav">
    
    
      <a class="next" href="/2018/06/30/2018-06-30-cocoapods-static-library/">
        <span class="next-text nav-default">CocoaPods 打包静态库</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

        
  <div class="comments" id="comments">
    
    <div style="text-align:center;">
        <button class="btn" id="load-disqus" onclick="disqus.load();">加载 Disqus 评论</button>
    </div>
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


      </footer>
    
  </article>

    </div>

      </div>

      <footer id="colophon"><span class="copyright-year">
    
        &copy;
    
        2016 -
    
    
<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/7.5.0/firebase-app.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
<script src="https://www.gstatic.com/firebasejs/7.5.0/firebase-analytics.js"></script>

<script>
  // Your web app's Firebase configuration
  var firebaseConfig = {
    apiKey: "AIzaSyCLSX-Z_14rwcYrgyc7mVXI0lBHnzQjIOo",
    authDomain: "blog-5bf4e.firebaseapp.com",
    databaseURL: "https://blog-5bf4e.firebaseio.com",
    projectId: "blog-5bf4e",
    storageBucket: "blog-5bf4e.appspot.com",
    messagingSenderId: "23978860195",
    appId: "1:23978860195:web:802fdb66f68722c0bda916",
    measurementId: "G-MZPGKWFTEP"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  firebase.analytics();
</script>

    2019
    <span class="footer-author">acumen1005.</span>
    <span class="power-by">
        Powered by <a class="hexo-link" href="https://hexo.io/">Hexo</a> and <a class="theme-link" href="https://github.com/frostfan/hexo-theme-polarbear">Polar Bear</a>
    </span>
</span>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>
    

<script type="text/javascript">
  var disqus_shortname = 'https-acumen1005-github-io';
  var disqus_identifier = '2018/10/09/2018-10-09-shortcuts/';

  var disqus_title = "Shortcuts App";


  var disqus = {
    load : function disqus(){
        if(typeof DISQUS !== 'object') {
          (function () {
          var s = document.createElement('script'); s.async = true;
          s.type = 'text/javascript';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
          }());
          $('#load-disqus').remove(); ///加载后移除按钮
        }
    }
  }

  
    var disqus_config = function () {
        this.page.url = disqus_url;
        this.page.identifier = disqus_identifier;
        this.page.title = disqus_title;
    };
  

</script>


    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  

    <script type="text/javascript" src="/js/src/theme.js?v=1.1"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=1.1"></script>

  </body>
</html>
